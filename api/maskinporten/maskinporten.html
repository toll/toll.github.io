<!DOCTYPE html>
<html lang="no" xmlns="http://www.w3.org/1999/html">
<head>
    <meta charset="UTF-8">
    <title>Maskinporten</title>
    <meta name="description" content="Tolletatens integrasjon med Maskinporten">
    <meta name="author" content="Tolletaten">
    <link rel="stylesheet" href="../../style/api.css">
    <link rel="icon" href="../../media/toll-logo/favicon.ico"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="theme-color" content="#000000"/>
    <link rel="shortcut icon" href="../../media/toll-logo/logo32.png" type="image/png"/>
    <link rel="apple-touch-icon" href="../../media/toll-logo/logo152.png"/>
    <link rel="apple-touch-icon-precomposed" href="../../media/toll-logo/logo152.png"/>
    <meta name="msapplication-TileColor" content="#FFFFFF"/>
    <meta name="msapplication-TileImage" content="/logo152.png"/>
</head>
<body>


<header>
    <a href="../../index.html">
        <img src="../../media/toll-logo/logo-toll.svg" alt="Tolletaten" class="logo"/>
    </a>

    <a href="../maskinporten/maskinporten-EN.html" class="nav-language-button" role="navigation">
        <div class="lang_nav">
            <span>EN</span>
            <img class="flag-rounded" src="../../media/flag/ENG-flag.svg" alt="Engelsk flagg">
        </div>
    </a>
</header>

<main class="maskinporten">
    <div class="align-self-start about-section" role="main">
        <nav aria-label="breadcrumb">
            <ol class="breadcrumb">
                <li class="breadcrumb-item"><a href="../../index.html">Hjem</a></li>
                <li class="breadcrumb-item active" aria-current="page">Maskinporten</li>
            </ol>
        </nav>

        <h1 id="hva-er-maskinporten">Hva er Maskinporten?</h1>
        <p>
            <img class="img-right"
                 src="../media/digdir-logo.png"
                 alt="digdir-logo"/>
            Maskinporten og Altinn er nasjonale
            felleskomponenter utviklet og driftet av
            Digitaliseringsdirektoratet som sammen skal gjøre
            det enklere å dele og bruke data på tvers av
            systemer. Løsningene sørger for verifisering av
            identiteten til virksomheter og gi disse riktig
            tilgang til data som offentlige virksomheter tilbyr
            via grensesnitt. En forutsetninger for å benytte
            Maskinporten og Altinn er at organisasjonen er
            registrert i Enhetsregisteret med norsk
            organisasjonsnummer.
        </p>

        <br/>

        <p>
            <strong>Maskinporten</strong> er en løsning hos
            Digitaliseringsdirektoratet
            (<a href="https://samarbeid.digdir.no/maskinporten/maskinporten/25"
                target="_blank">Digdir</a>) for tilgangsstyring for
            virksomheter som utveksler data. Løsningen
            garanterer identitet mellom virksomheter og sørger
            for autentisering ved kommunikasjon
            maskin-til-maskin. Den gjør det mulig å binde
            sammen systemer og utvikle nye tjenester på en
            effektiv måte.
        </p>

        <br/>

        <p>
            Fremtidig mulighet, men ikke innført: <strong>Altinn
            (autorisasjon)</strong> gir mulighet for delegering
            av rettigheter til andre organisasjoner eller
            personer. Baserer seg på registrerte roller i
            Enhetsregisteret.
        </p>

        <br/>

        <p>
            Maskinporten sørger for sikker autentisering og
            tilgangskontroll for datautveksling mellom
            virksomheter. Løsningen garanterer identiteten
            mellom virksomheter og gjør det mulig å binde sammen
            systemer og utvikle nye tjenester på en effektiv
            måte.
        </p>

        <h1 id="drift">Drift og overvåking</h1>
        <p>
            Maskinporten skal ha en oppetid på 99,9% og ved avvik har den sjelden nedetid
            mer enn 5 minutter. Vi anbefaler derfor at våre klienter implementerer en
            retry-mekanisme slik at man <em>prøver på nytt</em> dersom meldinger blir
            avvist uten forklarlige feilmeldinger.
        </p>
        <p>Vi anbefaler videre å følge med på planlagt og ikke-planlagt driftsavvik:</p>
        <ul>
            <li><a href="https://status.digdir.no/history?filter=nthvr1xysxs7" target="_blank">Digitaliseringsdirektoratet
                Status - Historikk</a> under <a href="https://status.digdir.no/">https://status.digdir.no/</a></li>
        </ul>
        <p>Det er også mulig å verifisere om Maskinporten er oppe ved å benytte linkene under:</p>
        <ul>
            <li><p><a href="https://oidc.difi.no/idporten-oidc-provider/health"
                      class="uri" target="_blank">https://oidc.difi.no/idporten-oidc-provider/health</a></p></li>
            <li><p><a href="https://maskinporten.no/health"
                      class="uri" target="_blank">https://maskinporten.no/health</a></p></li>
        </ul>
        <a href="https://docs.digdir.no/docs/Maskinporten/maskinporten_feilsoking" target="_blank">Maskinporten har
            også laget en side med feilsøkingsforslag på</a>

        <br/>

        <h1 id="hva-skal-til-for-a-bruke-maskinporten">Hva skal til for å bruke Maskinporten?</h1>

        <a href="https://docs.digdir.no/docs/Maskinporten/maskinporten_guide_apikonsument" target="_blank">Guide som
            er i tråd med Maskinportens egen dokumentasjon</a>

        <br/>
        <br/>

        <a href="https://samarbeid.digdir.no/maskinporten/konsument/119" target="_blank">Se også Digdirs guide for
            hvordan komme i gang med Maskinporten:</a>

        <h2 id="orgnummer">Forutsetning: norsk organisasjonsnummer</h2>
        <p>
            Det er en forutsetning for bruk av Maskinporten at man er registrert i Enhetsregisteret
            med et norsk organisasjonsnummer.
        </p>

        <br/>

        <h3 id="anskaffe-virksomhetssertifikat">1. Anskaffe virksomhetssertifikat for test og prod</h3>
        <p>
            Digdir vil validere din signatur mot ditt virksomhetssertifikat som
            er utstedt av en kjent sertifikattilbyder. Finn mer dokumentasjon <a
                href="https://docs.digdir.no/docs/Maskinporten/maskinporten_virksomhetssertifikat"
                target="_blank">hos Digdir</a>.
        </p>
        <p>
            Her er noen alternativer for anskaffelse av virksomhetssertifikat:</p>
        <ul>
            <li><p><a
                    href="https://www.commfides.com/commfides-virksomhetssertifikat/" target="_blank">
                https://www.commfides.com/commfides-virksomhetssertifikat/</a>
            </p></li>
            <li><p><a
                    href="https://www.buypass.no/produkter/virksomhetssertifikat-esegl" target="_blank">
                https://www.buypass.no/produkter/
                virksomhetssertifikat-esegl</a>
            </p></li>
        </ul>

        <br/>

        <h3 id="bli-kunde-hos-digdir">2. Bli kunde hos Digdir for tilgang til samarbeidsportalen</h3>
        <p>Ta kontakt med Digdir
            via <a href="mailto:servicedesk@digdir.no">servicedesk@digdir.no</a></p>

        <br/>

        <h3 id="bli-api-kunde">3. Registrer deg for tilgang hos Tolletaten</h3>
        <p>
            Skjema for innmelding finner du her: <a target="_blank"
                                                    href="https://toll.no/no/bedrift/digital-tollbehandling/meldeogopplysningsplikt/digital-samhandler-med-tolletaten/">Registrering:
            Digitoll-aktør - Tolletaten</a>
        </p>
        <p>Tolletaten gir tilgang til det/de scopene som trengs for aktuell integrasjon, se
            <a href="#scopes">oversikt under</a>.</p>

        <br/>

        <h3 id="lag-en-integrasjon">4. Lag en integrasjon hos Digdir og koble denne opp mot Tolletatens API
            (scope)</h3>
        <p>For <strong>PROD</strong>: Logg deg inn på <a href="https://sjolvbetjening.samarbeid.digdir.no" target="_blank">Samarbeidsportalen selvbetjening (digdir.no)</a>
        <p>For <strong>TEST</strong>: Logg deg inn på <a href="https://sjolvbetjening.test.samarbeid.digdir.no" target="_blank">Samarbeidsportalen selvbetjening (digdir.no)</a>
        </p>

        <ul class="spaced-list">
            <li>Difi-tjeneste = Maskinporten</li>
            <li>Legg til scopes &ndash; se <a href="#scopes">oversikt over våre scopes under</a></li>
            <li>
                <em>Integrasjonens identifikator:</em> Dette er det som skal være satt i
                "iss"-feltet av din JWT som sendes til Difi (jf.
                <a href="#hent-maskinporten-token">avsnitt under</a>).
            </li>
            <li>
                <em>Navn på integrasjonen</em>: Her står du fritt selv til å velge hva
                integrasjonen mot Tolletaten skal hete.<br/>
                Det kan lønne seg å gi et navn som skiller på ulike tjenester og API-er for
                Tolletaten, siden vi har flere ulike API-er.
            </li>
            <li>
                <em>Grant-types</em>:
                Vi bruker <code>urn:ietf:params:oauth:grant-type:jwt-bearer</code> nå,
                dette kan endre seg på sikt.
            </li>
        </ul>

        <br/>

        <section class="image-border">
            <div>
                <h4 id="integrasjon-selvbetjening">4.1 Gå til selvbetjening av integrasjoner</h4>
                <figure>
                    <img class="image-size" src="../media/maskinporten/maskp-login.png" alt="Gå til selvbetjening"/>
                    <figcaption>Figur: Login på selvbetjening</figcaption>
                </figure>

                <figure>
                    <img class="image-size" src="../media/maskinporten/maskp-virksomhet.png" alt="Velg virksomhet"/>
                    <figcaption>Figur: Velg din virksomhet</figcaption>
                </figure>

                <figure>
                    <img class="image-size" src="../media/maskinporten/maskp-klient.PNG" alt="Velg klient"/>
                    <figcaption>Figur: For deg som skal integrere en tjeneste, velg Klient</figcaption>
                </figure>

                <h4 id="ny-integrasjon">4.4 Ny integrasjon</h4>
                <figure>
                    <img class="image-size" src="../media/maskinporten/maskp-klienter-legg-til-ny.PNG" alt="Legg til ny integrasjon."/>
                    <figcaption>
                        Figur: Her er en liste av dine klienter. For en ny klient integrasjon, trykk Legg til ny.
                    </figcaption>
                </figure>

                <figure>
                    <img class="image-size" src="../media/maskinporten/maskp-maskinporten.PNG" alt="Velg maskinporten"/>
                    <figcaption>Figur: Velg Maskinporten.</figcaption>
                </figure>

                <figure>
                    <img class="image-size" src="../media/maskinporten/maskp-legg-til-scope.PNG" alt="Velg Legg til scope"/>
                    <figcaption>
                        Figur: Etter å ha fylt ut selvvalgt navn og din beskrivelse, trykk på Legg til scope
                    </figcaption>
                </figure>

                <figure>
                    <img class="image-size" src="../media/maskinporten/maskp-scopes.PNG" alt="Velg scopene du trenger"/>
                    <figcaption>
                        Figur: Velg scopene du trenger. Du finner <a href="#scopes">oversikt under</a>
                    </figcaption>
                </figure>

                <figure>
                    <img class="image-size" src="../media/maskinporten/maskp-integrasjon.PNG" alt="Oversikt over integrasjonen"/>
                    <figcaption>
                        Figur: Etter å ha trykket på opprett. Så vil du få en oversikt over din integrasjoner/klienter.
                        Trykk på den du nettopp opprettet for å se detaljer og eventuelt redigere.
                    </figcaption>
                </figure>
            </div>
        </section>

        <div class="about-section-text">
            <h3 id="klientintegrasjon">5. Klientintegrasjon</h3>
            <p>
                API-konsumenter må selv utvikle en applikasjon/system som
                henter access token fra Maskinporten og veksler disse inn mot
                Toll-signerte access tokens.
            </p>
            <p class="tips_box_normal">
                <strong>TIPS:</strong><br/>
                Et Toll-signert access token kan brukes i hele dets levetid, derfor
                anbefales det å mellomlagre disse når en kommuniserer med Tolletatens
                API-er. For en mer sømløs opplevelse anbefaler vi videre å utveksle til
                et nytt Toll token før (f.eks 1 minutt før) levetiden til det foregående
                utgår.
            </p>

            <br/>

            <h3 id="scopes">Våre scopes</h3>
            <p>Hvilke(t) scope du skal bruke avhenger av hvilke
                tjenester du skal ta i bruk, og krever tildelt tilgang til
                dette scopet fra Tolletaten:</p>
            <ul class="spaced-list">
                <li>movement-road-api: <strong>toll:movement/road</strong></li>
                <li>movement-road-api-v2, movement-road-query-api-v2: <strong>toll:movement/road/v2</strong></li>
                <li>movement-air-api, movement-air-query-api: <strong>toll:movement/air</strong></li>
                <li>movement/presentation, movement/routing: <strong>toll:movement/entry</strong></li>
                <li>Dokumentopplasting: <strong>toll:goodsdeclaration/document.write</strong></li>
            </ul>

            <br/>

            <h4 id="hent-maskinporten-token">5.1 Hent access token fra Maskinporten</h4>
            <p>Se Maskinportens egen <a
                    href="https://docs.digdir.no/docs/Maskinporten/maskinporten_guide_apikonsument"
                    target="_blank">dokumentasjon</a> på hvordan hente ut et access token.</p>
            <p class="tips_box_normal">
                <strong>TIPS:</strong><br/> Difi har publisert
                et <a href="https://github.com/difi/jwt-grant-generator"
                      target="_blank">repository på github
                (jwt-grant-generator)</a> som demonstrer hvordan en kan
                hente ut access token fra Difis tjenester, deriblant
                Maskinporten.
            </p>

            <br/>
            <!--
                    <h4 id="deleger-roller">5.2 Deleger roller i Altinn</h4>
                    <p>
                        Dersom man benytter en systemleverandør for å utveksle informasjon
                        med Tolletaten må rettigheter delegeres via Altinn: <a
                                href="https://www.altinn.no/hjelp/profil/roller-og-rettigheter/hvordan-gi-rettigheter-til-andre/"
                                class="uri" target="_blank">https://www.altinn.no/hjelp/profil/roller-og-rettigheter/hvordan-gi-rettigheter-til-andre/</a>.
                    </p>
                    <p>
                        Om du ønsker å finne ut hva rollene gir tilgang til, logg inn i
                        Altinn og se under <em>Skjema og tjenester du har rettighet til</em>,
                        der får du oversikt over rollene du har for den aktøren du
                        representerer. Til høyre for hver rolle finner du et spørsmålstegn,
                        klikk der og du vil se hvilke tilganger rollen gir deg.
                    </p>
            -->
            <h4 id="veksle-token">5.2 Veksle Maskinportens access token til et Toll-signert access token</h4>

            <h5 id="http-request">HTTP Request</h5>
            <p>Method: <strong>POST</strong></p>
            <p>URL:</p>
            <table>
                <thead>
                <tr>
                    <th scope="col">Miljø</th>
                    <th scope="col">URL</th>
                </tr>
                </thead>
                <tbody>
                <tr>
                    <td>Test</td>
                    <td><a href="https://api-test.toll.no/api/access/external/oauth/token">
                        https://api-test.toll.no/api/access/
                        external/oauth/token</a></td>
                </tr>
                <tr>
                    <td>Produksjon</td>
                    <td><a href="https://api-test.toll.no/api/access/external/oauth/token">
                        https://api.toll.no/api/access/
                        external/oauth/token</a></td>
                </tr>
                </tbody>
            </table>

            <p>HEADER:</p>
            <table>
                <thead>
                <tr>
                    <th scope="col">Header</th>
                    <th scope="col">Value</th>
                </tr>
                </thead>
                <tbody>
                <tr>
                    <td>Content-type</td>
                    <td>application/x-www-form-urlencoded</td>
                </tr>
                </tbody>
            </table>

            <p>BODY:</p>
            <table>
                <thead>
                <tr>
                    <th scope="col">Key</th>
                    <th scope="col">Value</th>
                </tr>
                </thead>
                <tbody>
                <tr>
                    <td>grant_type</td>
                    <td>token-exchange</td>
                </tr>
                <tr>
                    <td>subject_token_type</td>
                    <td>access_token</td>
                </tr>
                <tr>
                    <td>subject_token</td>
                    <td>&lt;MASKINPORTEN ACCESS TOKEN HER&gt;</td>
                </tr>
                </tbody>
            </table>

            <h5 id="eksempel-http-response">Eksempel: HTTP Response</h5>
            <p><strong>Maskinporten Access Token - Response</strong></p>

            <pre class="boxed-display">
{
  "issued_token_type": "access_token",
  "access_token": "&lt;TOLL ACCESS TOKEN HER&gt;"
  "token_type": "Bearer",
  "expires_in": 970
}

</pre>

            <h4 id="teste-tilgang-til-api">5.3 Teste tilgang til API-et</h4>
            <p>Dette eksempelet gjelder for API-et for kjøretøy på vei.</p>

            <h5 id="http-request-1">HTTP Request</h5>
            <p>Method: <strong>GET</strong></p>
            <p>URL:</p>
            <table>
                <thead>
                <tr>
                    <th scope="col">Miljø</th>
                    <th scope="col">URL</th>
                </tr>
                </thead>
                <tbody>
                <tr>
                    <td>Test</td>
                    <td><a href="https://api-test.toll.no/api/movement/road/v1/test-auth">
                        https://api-test.toll.no/api/movement/
                        road/v1/test-auth</a>
                    </td>
                </tr>
                <tr>
                    <td>Produksjon</td>
                    <td><a href="https://api-test.toll.no/api/movement/road/v1/test-auth">
                        https://api.toll.no/api/movement/
                        road/v1/test-auth</a>
                    </td>
                </tr>
                </tbody>
            </table>

            <p>HEADER:</p>
            <table>
                <thead>
                <tr>
                    <th scope="col">Header</th>
                    <th scope="col">Value</th>
                </tr>
                </thead>
                <tbody>
                <tr>
                    <td>Authorization</td>
                    <td>Bearer &lt;TOLL ACCESS TOKEN&gt;</td>
                </tr>
                </tbody>
            </table>
            <p>Forventet resultat er <strong>200 OK</strong>.</p>
        </div>
    </div>
</main>

<footer role="contentinfo">
    <a href="https://www.toll.no/">Tolletaten</a> 2025 | <a href="https://www.toll.no/no/om-tolletaten/kontakt-oss/"
                                                            class="footerLink">Kontakt oss</a>
</footer>

</body>
</html>
